import data_source
import os


def get_file_contents(name):
    contents = []

    with open(name, 'r') as file:
        for line in file.readlines():
            line_without_line_number = line.replace("\r", "").replace("\n", "").split(" ")[1:]

            if '??' not in line_without_line_number:
                line_bytes = [bytes.fromhex(hex_byte) for hex_byte in line_without_line_number if hex_byte is not '??']

                contents.append(b''.join(line_bytes))

    return contents


def get_file_data(num=data_source.num_files):
    labels = []

    with open(data_source.train_labels) as labels_file:
        labels_file.readline()  # discard header

        for i in range(num):
            row = labels_file.readline().split(',')

            file_name = row[0].replace("\"", "")
            malware_id = int(row[1])
            file_contents_bytes = get_file_contents(os.path.join(data_source.train_data, file_name + ".bytes"))

            labels.append((file_name, malware_id, file_contents_bytes))

    return labels
